# 嵌入式通信协议

## 基本概念
- 并行传输：以字或字节为单位、多个位同时传输；快、线多、不宜远距离通信
- 串行传输：逐位传输，慢、通信线少、适宜远距离通信

> 几乎所有计算机控制系统均采用串行数据通信


- 单工通信：单一方向传输，没有反向交互(如传统的键盘、鼠标通信)
- 半双工通信：双方可以交互数据，但不在同时，应用广泛(只需2根通信线)
- 全双工通信：双方可以同时交互数据，效率高，至少3根(共地)或4根通信线

  - 全双工要求双方能同时收发数据，所以不能共用数据线。

  - 必须分开发送线（TX）和接收线（RX），形成两个独立的通信方向。

  - GND 是必须的：双方电平参考必须一致，否则无法可靠解码信号。



波特率
波特率：指单位时间内传输的信息量，单位通常用“位/秒”表示



- 基带传输：数字信号的数字传输。按数字波形、以“位”流形式直接在信道上传输，速度较高，远距离传输易因信号衰减发生畸变（中继）
- 频带传输：数字信号的模拟传输。也称为载波传输，发送端把数字信号调制成一定频带范围的模拟信号，接收方解调还原。如HART信号，FSK
- 宽带传输：适用于传输影像、语音信息


=== "差动传输"

    差动传输指的是：信号不是相对于地（GND）传输的，而是两个信号线之间的电压差表示信号的逻辑状态。

    📌 举个例子（以 RS-485 为例）：
    RS-485 有两条信号线：A 和 B

    它规定：

    当 A > B（例如 A=5V，B=0V）时，表示逻辑 1

    当 A < B（例如 A=0V，B=5V）时，表示逻辑 0

    接收器只关心 A 和 B 之间的电压差（A-B），而不关心它们对地的电压是多少。

    🎯 好处：
    能有效抵抗电磁干扰（EMI）：外界干扰会同时影响 A、B 两根线，差值不变

=== "双线平衡"
    双线平衡是差动传输的一种实现方式，它强调信号在线路上的对称性和平衡性，即：

    发送端同时在两根线上发送等幅反向的信号，接收端感应两线之间的差值。

## UART

## TTL电平


## RS232 - 全双工

RS-232标准是一种全双工通信协议

标准接口是25针D型插头；后简化成9针，一般只用TXD、RXD、GND三条线

- 单端输入（单线共地），抗干扰能力弱
- 工作速率低（19.6Kbps）、通信距离短（15m，加Modem可延长）

- **原理**  
  - 由EIA制定的异步串行通信标准，采用负逻辑电平（逻辑1：-5V~-15V，逻辑0：+5V~+15V）。  

- **应用**  
  - 早期计算机与调制解调器、打印机连接，工业控制设备通信。  

| 引脚顺序 | 引脚作用+名称 |
| --- | --- |
| 1 | 数据载波检测 | DCD |
| 2 | 数据发射 | TXD |
| 3 | 数据接收 | RXD |
| 4 | 数据设备准备 | DSR |
| 5 | 地 | GND |
| 6 | 数据终端准备 | DTR |
| 7 | 清除发送 | CTS |
| 8 | 请求发送 | RTS |
| 9 | 振铃指示 | RI |

## RS422 - 全双工


RS-422 是由 RS-232 改进而来：

- 接口采用**差分、双线**平衡传输，抑制共模干扰能力强
- 接收器高输入阻抗，发送驱动能力更强
- 最高传输速率可达 10 Mbps
- 最大通信距离 1200 m（不加中继，且与速率有关）
- 传输线可连接多个接收节点
- 支持全双工通信

![](https://philfan-pic.oss-cn-beijing.aliyuncs.com/img/20250607163255.png)

## RS485

- **原理**  
  - 差分信号传输（A/B线电压差表示逻辑），支持半双工/全双工，抗干扰能力强。  
  - 传输距离达1200米，波特率最高10Mbps（随距离降低），支持多点连接（同一网段最大支持32个节点，如果使用特制芯片，可以连接128个甚至更多节点）。  
- **应用**  
  - 工业自动化（PLC、传感器网络）、楼宇控制、远距离数据采集。  




## **USB/PCIe/SATA**
- **USB**  
  - 通用串行总线，支持热插拔，版本包括USB 2.0（480Mbps）、USB 3.2（20Gbps）。  
  - 应用：外设连接（键盘、摄像头）、移动设备充电。  
- **PCIe**  
  - 高速串行计算机扩展总线，点对点架构，通道数可扩展（x1/x16）。  
  - 应用：显卡、NVMe SSD、数据中心互联。  
- **SATA**  
  - 串行ATA接口，替代并行IDE，速率最高6Gbps（SATA III）。  
  - 应用：机械硬盘、固态硬盘连接。

## **CAN（控制器局域网）**
- **原理**  
  - 差分信号（CAN_H/CAN_L），多主架构，CSMA/CD+非破坏性仲裁（优先级高的ID胜出）。  
  - 帧格式包含ID、数据、CRC校验，错误检测机制完善（如ACK超时）。  
- **应用**  
  - 汽车电子（ECU通信）、工业控制（电梯、机械臂）。  
- **特点**  
  - 抗干扰强；传输距离长（5kbps下可达10km）；实时性高。

## **I2C**
- **原理**  
  - 两线制（SDA、SCL），多主多从，7/10位地址寻址，支持标准（100kbps）、快速（400kbps）模式。  
  - 起始/停止条件定义通信周期，ACK/NACK应答机制确保数据完整性。  
- **应用**  
  - 传感器（温度、加速度计）、EEPROM、LCD控制器（如OLED驱动）。  
- **特点**  
  - 引脚少；支持总线仲裁；速率低于SPI，适合低速设备互联。


## **SSI（同步串行接口）**
- **原理**  
  - 基于RS-422的差分通信，主设备提供单向时钟，从设备在上升沿输出数据。  
  - 数据帧包含位置信息（二进制或格雷码），支持单圈/多圈绝对值编码器。  
- **应用**  
  - 高精度工业编码器（如机器人关节控制）、数控机床位置反馈。  
- **特点**  
  - 抗干扰强；时钟频率80kHz~2MHz；需FPGA或专用SPI模式配置时序。

## **SPI**
- **原理**  
  - 全双工同步串行接口，四线制（SCLK、MOSI、MISO、SS），主从架构。  
  - 数据在时钟边沿采样，支持多从机（每从机独立SS片选）。  
- **应用**  
  - Flash存储器、ADC/DAC、触摸屏控制器（如TFT驱动）。  
- **特点**  
  - 速率高（可达100MHz）；无寻址机制；引脚多但传输效率高。



## **以太网**
- **原理**  
  - 基于IEEE 802.3，物理层（PHY）和MAC层协同工作，双绞线（CAT5e/6）或光纤传输。  
  - TCP/IP协议栈支持，速率从10Mbps到100Gbps，全双工通信。  
- **应用**  
  - 局域网（企业网络）、互联网接入、车载以太网（自动驾驶数据传输）。  
- **关键点**  
  - 交换机实现数据包转发；PoE（以太网供电）简化设备部署。



