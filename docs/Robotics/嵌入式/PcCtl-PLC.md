# PLC



## 系统组成和硬件构成


简单介绍常识


<iframe src="//player.bilibili.com/player.html?isOutside=true&aid=1550905959&bvid=BV1Py421z7vZ&cid=1448947420&p=1&autoplay=0" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe>


负载电源（PM）

- 为各种模块、其他负载提供外接 24V 电源。
- 为部分 PS 模块提供 24V 电源。

系统电源（PS）

- 通过背板总线为模块提供内部所需的电源（外部负载回路还需由 PM 接线来供电）。
- 只能为 CPU 和本机加模块供电。



AI连接

AI接口接收4～20mA电流输入，如何连接


![](https://philfan-pic.oss-cn-beijing.aliyuncs.com/img/202504042327077.png)


- PLC 为每个输入分配好了独立的内存地址

I0.0 false
I0.1 true

- 输出也分配了独立的内存

内存：内部存储器
断电不保存

外部存储器
- 无法直接处理


PLC（可编程逻辑控制器）的主要组件包括以下部分：

### 1. **CPU（中央处理单元）**
   - **功能**：PLC 的核心组件，负责处理程序逻辑、执行运算、存储数据，并控制其他模块的运行。
   - **组成**：
     - **处理器**：执行用户编写的控制程序（梯形图、STL 语言等）。
     - **存储器**：
       - **ROM（只读存储器）**：存储 PLC 固件和系统程序。
       - **RAM（随机存取存储器）**：存储用户程序、运行时数据、I/O 状态等。
       - **EEPROM/Flash**：用于掉电保持用户程序和参数。
   - **通讯接口**：用于与上位机、HMI（人机界面）或其他设备通讯（如 RS-232、RS-485、Ethernet）。

---

### 2. **DI（数字输入，Digital Input）**
   - **功能**：用于接收外部开关量信号（如按钮、限位开关、光电传感器等）。
   - **特点**：
     - 只接收两种状态的信号：**0（低电平）**或**1（高电平）**。
     - 常见电压等级：**DC 24V、DC 12V、AC 220V** 等。
     - 可能分为**漏型（NPN）**和**源型（PNP）**输入。

---

### 3. **DO（数字输出，Digital Output）**
   - **功能**：用于控制外部设备的开关状态（如继电器、电磁阀、信号灯等）。
   - **类型**：
     - **继电器输出（Relay Output）**：使用继电器控制，适用于高电压、高电流负载。
     - **晶体管输出（Transistor Output）**：
       - NPN 输出（低电平有效）
       - PNP 输出（高电平有效）
     - **可控硅输出（Triac Output）**：适用于交流负载。
   - **特点**：
     - 只能输出**开（1）**或**关（0）**信号。
     - 典型输出电压：DC 24V、AC 220V 等。

---

### 4. **AI（模拟输入，Analog Input）**
   - **功能**：用于接收外部模拟信号（如压力传感器、温度传感器、流量计等）。
   - **类型**：
     - 电压输入（**0-10V、±10V**）。
     - 电流输入（**4-20mA、0-20mA**）。
   - **特点**：
     - 需要 A/D（模数转换）转换，将模拟信号转换为数字信号供 CPU 处理。
     - 通常具有**分辨率**（如 12-bit、16-bit）影响信号精度。

---

### 5. **AO（模拟输出，Analog Output）**
   - **功能**：用于输出模拟信号控制外部设备（如变频器、伺服驱动器、调光系统等）。
   - **类型**：
     - 电压输出（**0-10V、±10V**）。
     - 电流输出（**4-20mA、0-20mA**）。
   - **特点**：
     - 需要 D/A（数模转换）转换，将数字信号转换为模拟信号输出。
     - 输出信号可以用于调节电机速度、阀门开度等。

### 冗余系统与可靠度

**无故障概率**：单元设备在规定的环境温度、湿度、振动和使用方法及维护措施等条件下，在规定的工作期限内，设备无故障地发挥规定功能的概率。

- 并联可以提高系统的可靠性（冗余）
- 冗余设计： 1oo1、1oo2、2oo2、2oo3


!!! note "可靠度的计算"
    ![](https://philfan-pic.oss-cn-beijing.aliyuncs.com/img/20250402190726.png)

    第二个题计算的时候，可以按照中间的块是否有效进行分类讨论；

    - 如果有效，则可以等效为左边的块
    - 如果无效，则可以等效为串联电路

    可以使用下面的代码进行验证

    ```python title="枚举法——计算成功的概率"
    from itertools import product

    # 定义成功的条件
    success_conditions = [
        (1, 3),
        (1, 4, 5),
        (2, 5),
        (2, 3, 4)
    ]

    # 生成所有可能的情况
    all_cases = list(product([0, 1], repeat=5))

    # 计算每种情况的概率
    probabilities = {}
    total_probability = 0
    for case in all_cases:
        probability = 0.8 ** sum(case) * 0.2 ** (5 - sum(case))
        probabilities[case] = probability
        total_probability += probability

    # 计算成功的概率
    success_probability = 0
    for case, probability in probabilities.items():
        for condition in success_conditions:
            if all(case[i-1] == 1 for i in condition):
                success_probability += probability
                break

    # 输出结果
    print("所有可能的情况及其对应的概率：")
    for case, probability in probabilities.items():
        print(f"{case}: {probability}")

    print(f"所有情况的概率之和为：{total_probability}")
    print(f"成功的概率为：{success_probability}")
    ```




## 数据类型

可支持二进制、十进制、十六进制、BCD码、ASCII码、时间、日期等格式的数据


| 常见的数据类型 | 描述 | 位数 | 常数举例 | 编程举例 |
| --- | --- | --- | --- | --- |
| BOOL | 二进制位 | 1 | TRUE/FALSE | I3.2 |
| BYTE | 字节 | 8 | B#16#2F | IB3，由I3.0~I3.7组成的一个字节 |
| WORD | 无符号字 | 16 | W#16#247D | MW100，MB100,MB101组成的字 |
| DWORD | 无符号双字 | 32 | DW#16#149E857A | MD100 |
| LWORD | 长字 | 64 | LW#16#ADAC1EF5 | - |
| INT | 有符号整数 | 16 | -362 | -32768~32768 |
| DINT | 有符号长整数 | 32 | L#23 | -2147483648~2147483647 |
| REAL | IEEE浮点数 | 32 | 20.1234 | - |
| S5TIME | SIMATIC时间 | 16 | S5T#1H3M50S | - |
| TIME | IEC时间 | 32 | T#1H3M50S | - |
| LTIME | IEC时间 | 64 | T#11350d20h25m14s830ms652μs315ns | - |
| CHAR | ASCII字符 | 8 | '2A' | - |


位、字节、字、双字的关系



## 地址

| 地址区域 | 可以访问的地址单位 | 符号及标识方法 | 说明 |
| --- | --- | --- | --- |
| 过程映像输入区 | 位·字节·字·双字 | **I**·IB·**IW**·ID | 对应输入模块端口 |
| 过程映像输出区 | 位·字节·字·双字 | **Q**·QB·**QW**·QD | 对应输出模块端口 |
| 标志位存储区 | 位·字节·字·双字 |M·MB·MW·MD | 全局变量区 |
| **数据块** | 位·字节·字·双字 | DBX·DBB·DBW·DBD | 用**OPN DB**打开<br>|
|| 位·字节·字·双字 | DIX·DIB·DIW·DID | 用**OPN DI**打开 |
| 定时器 | 位 | T | - |
| 计数器 | 位 | C | - |
| 本地数据区 | 位·字节·字·双字 | L·LB·**LW**·LD | 局部变量 |

- 不建议绝对地址寻址,确有需要，可修改数据块属性（非优化模式

每一通道均配置独立的地址，应用程序根据地址实现IO操作开关量1/0模块

- 开关量IO：每个通道的地址占1位（1bit），16通道模块的地址占2字节，32通道模块地址占4字节模拟量1/0模块
- 模拟量IO模块：**每个模拟量地址为16位（2字节）**，8通道模块的地址占16字节，2通道模块地址占4字节

I/O地址生成方式：在配置硬件时，系统自动提供缺省地址（推荐使用，通常地址是够用的），也可手动设置地址 




### 寻址方式

#### 立即寻址
x.y
- x:  字节数：0-65536
- y:  位数：0-7 

1D = W = B = bit



#### 直接寻址

#### 存储器间接寻址


#### 寄存器间接寻址

## 程序结构
### 组织块（OB）
- **OB1块**：对应于C语言中的`main()`函数，是程序的入口点。  


- **其他OB块**：对应于中断函数，用于处理特定的中断事件。  


设置不同的组织块，用以完成不同的功能

每一个OB块都对应为一种有不同优先级的中断，优先级从1（最低）到26（最高）


### 函数/块（FC和FB）
- **FC（Function）**：子程序或函数，通过赋实参来调用。  
- **FB（Function Block）**：函数块，通过背景数据块赋值来调用。  

### 数据块（DB）全局变量

- 数据块是PLC最主要的数据存储区，需要用户自己定义，**相当于C语言全局变量**
- 主要存放IO结果、中间运算结果和状态、与其他设备或系统交互的数据等,块内数据可定义bool、byte、int、real、date、time等多种数据类型
- 数据块应先定义、后访问，可根据需要定义不同数据块
- 数据块分为共享数据块和背景数据块，本质都是全局变量
    - **共享数据块**：在多个程序块中使用，类似于C语言中的全局变量。
    - **背景数据块**定义：附属于某个FB块、数据结构与FB输入输出数据格式完全相符的数据块，可以理解为FB批量赋值的数据块，也可以当作一般DB块用




### 系统函数（SFB/SFC）

类似于库函数

- **SFB（System Function Block）**：系统功能块，提供特定的系统功能。  
- **SFC（System Function）**：系统功能，提供特定的系统服务。  



### 调用关系
- OB块只能被系统调用（被事件触发），不可以被其他程序调用。
- OB块可以调用FB或FC。
- FB或FC可以调用其他FB、FC。
- 系统为每个优先级分配64KB的临时变量（L堆栈），供组织块、程序块使用。
- 嵌套越深，占用L堆栈越多，需防止“爆栈”现象。
![](https://philfan-pic.oss-cn-beijing.aliyuncs.com/img/20250405001921.png)


## 程序

LAD(梯形图)、STL(语句表)、FBD(功能块图)、SCL(结构化语言，如类Pascal语言)、GRAPH(图表化语言)等，LAD和FBD可以互相转化，其他不可互相转化



编程语言对应：  
- **STEP 7**：用于西门子PLC编程的软件，支持结构化编程。  
- **C语言**：一种通用的编程语言，也支持结构化编程。  


### **1. LAD（梯形图 Ladder Diagram）**

**特点**：
- **图形化语言**：使用图形符号表示逻辑关系，类似于继电器控制电路图。
- **直观易懂**：适合电气工程师和初学者，易于理解和调试。
- **逻辑结构清晰**：通过梯级（Rung）表示逻辑关系，从上到下执行。

**应用场景**：
- 常用于简单的逻辑控制和顺序控制。
- 适合处理开关量信号和基本的逻辑运算。

### **2. FBD（功能块图 Function Block Diagram）**

**特点**：
- **模块化编程**：通过功能块（Function Block）实现模块化编程，提高代码复用性。
- **图形化语言**：使用图形符号表示功能块和信号流向。
- **适合复杂控制**：适合处理复杂的逻辑关系和算法。

**应用场景**：
- 常用于复杂的逻辑控制、过程控制和算法实现。
- 适合处理模拟量信号和复杂的数学运算。

### **3. SCL（结构化控制语言 Structured Control Language）**

**特点**：
- **文本化语言**：类似于高级编程语言（如C、Pascal），使用文本编写代码。
- **结构化编程**：支持结构化编程概念，如循环、分支、函数等。
- **灵活性高**：适合处理复杂的算法和数据处理。

**应用场景**：
- 常用于复杂的算法实现、数据处理和高级控制逻辑。
- 适合处理大量的数据和复杂的数学模型。

### **4. STL（语句表 Statement List）**

```
操作码 操作数(<=1个)
```

过程：读取指令、翻译代码、执行指令

- A1，A2 累加器
- AR1
- AR2


**特点**：
- **文本化语言**：使用文本编写代码，类似于汇编语言。
- **底层编程**：适合处理底层的硬件操作和优化。
- **执行效率高**：由于接近机器语言，执行效率较高。

**应用场景**：
- 常用于对执行效率要求较高的场合。
- 适合处理实时性要求高的控制任务。

```c title="模拟量读取"
L   %IW 256:P   //从端口地址(如256)读入转换结果，:P 表示脉冲采集
T   #Dec_in//存入临时变量Dec_in，#abc表示临时变量，变量名abc
CALL "SCALE"//直接调用系统函数，以下是输入输出参数
    IN      :=#Dec_in//入口参数：十进制转换结果
    HI_LIM  :=2.000000e+002//入口参数：工程量上限200,kPa（本身没有单位概念） 
    LO_LIM  :=0.000000e+000//入口参数：工程量下限0
    BIPOLAR :=FALSE//入口参数：TRUE为双极性，FALSE为单极性
    RET_VAL :=#ret//出口参数：返回值（准确－0，错误－其它值） 
    OUT     :=#In_result//出口参数：工程量转换结果
```

- 通过 `:=` 运算符将变量的值传递给函数参数。
- `:P` 表示脉冲采集
- `#abc` 表示临时变量，变量名`abc`
- `2.000000e+002` 是科学计数法表示的 200
- `%` 是一个前缀，用于表示特定的数据类型或地址空间
- **工程量**是指以物理计量单位或自然计量单位所表示的各个分项或子分项工程和构配件的数量单位

```stl
CALL "UNSCALE"                // 直接调用系统提供的转换函数，以下是输入输出参数
    IN     := #Out             // 入口参数：阀位值0 ~ 100%浮点数
    HI_LIM := 1.000000e+002   // 入口参数：阀位上限100
    LO_LIM := 0.000000e+000   // 入口参数：阀位下限0
    BIPOLAR := FALSE           // 入口参数：TRUE为双极性输出，FALSE单极性输出
    RET_VAL := #Err            // 出口参数：返回值
    OUT    := #Out_result      // 出口参数：十进制转换结果存入临时变量

L     #Out_result              // 将#Out_result的值加载到累加器1
T     %QW416:P                 // 十进制转换结果输出到过程输出缓冲区，如416
```

- `CALL` 是调用函数的关键字




## 系统开发


## 实验课


