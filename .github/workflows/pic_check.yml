name: post-deploy checks

on:
  workflow_run:
    workflows: ["deploy"]
    types:
      - completed

jobs:
  verify-docs:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Check image files exist under docs
        run: |
          set -e
          IMG_COUNT=$(find docs -type f \( -iname "*.png" -o -iname "*.jpg" -o -iname "*.jpeg" -o -iname "*.gif" -o -iname "*.webp" -o -iname "*.svg" -o -iname "*.bmp" -o -iname "*.tiff" -o -iname "*.ico" \) | wc -l | tr -d ' ')
          echo "Found ${IMG_COUNT} image files under docs"
          if [ "${IMG_COUNT}" -eq 0 ]; then
            echo "No image files found under docs"
            exit 1
          fi

      - name: Fail if any file under docs exceeds 10MB
        run: |
          set -e
          LARGE_FILES=$(find docs -type f -size +10M || true)
          if [ -n "${LARGE_FILES}" ]; then
            echo "Files larger than 10MB found under docs:" && echo "${LARGE_FILES}"
            exit 1
          else
            echo "No files larger than 10MB under docs"
          fi

